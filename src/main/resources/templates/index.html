<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ë©”ì¸</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/header.css}" />
  <link rel="stylesheet" th:href="@{/css/footer.css}" />
  <link rel="stylesheet" th:href="@{/css/index.css}" />
  <link rel="stylesheet" th:href="@{/css/chat/notification-system.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <div th:replace="~{header :: header}"></div>

  <section class="section-title text-center">
    <h1><strong>ìš”ì¦˜ ì¸ê¸° ìˆëŠ” ì„œë¹„ìŠ¤</strong></h1>
  </section>

  <!-- ìºëŸ¬ì…€ -->
  <div class="container">
    <div id="mainCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="/images/expert_it.png" class="d-block w-100" alt="ì²« ë²ˆì§¸ ë°°ë„ˆ" />
        </div>
        <div class="carousel-item">
          <img src="/images/expert_beauty.png" class="d-block w-100" alt="ë‘ ë²ˆì§¸ ë°°ë„ˆ" />
        </div>
        <div class="carousel-item">
          <img src="/images/expert_law.png" class="d-block w-100" alt="ì„¸ ë²ˆì§¸ ë°°ë„ˆ" />
        </div>
        <div class="carousel-item">
          <img src="/images/expert_car.png" class="d-block w-100" alt="ë„¤ ë²ˆì§¸ ë°°ë„ˆ" />
        </div>
        <div class="carousel-item">
          <img src="/images/expert_clean.png" class="d-block w-100" alt="ë‹¤ì„¯ ë²ˆì§¸ ë°°ë„ˆ" />
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">ì´ì „</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">ë‹¤ìŒ</span>
      </button>
    </div>
  </div>

  <!-- ê²Œì‹œíŒ, ë¦¬ë·° ìë¦¬ -->
  <section class="content-area">
    <div class="review-summary">
      <h2>âœ… ê²¬ì  í›„ê¸°</h2>
      <blockquote class="blockquote">
        "3ì¼ ë§Œì— ì „ë¬¸ê°€ë¥¼ ì°¾ì•˜ì–´ìš”! ì›í•˜ëŠ” ê²°ê³¼ì— ë„ˆë¬´ ë§Œì¡±í•©ë‹ˆë‹¤." - ê¹€**
      </blockquote>
      <a href="/user/quotationBoard/create" class="review-link">ê²¬ì  ìš”ì²­ â†’</a>
    </div>
	<br>
    <!-- ë¹„ë™ê¸° ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ì¡°íšŒìˆœ Top5 ìë¦¬ -->
    <h2>ğŸ“¢ MATCHERS ì»¤ë®¤ë‹ˆí‹°ì— ë¬¼ì–´ë³´ì„¸ìš”</h2>
    <div class="section-card">
      <table class="table table-bordered">
        <tbody id="top5CommunityPosts">
          <tr><td colspan="4">ë¡œë”© ì¤‘...</td></tr>
        </tbody>
      </table>
    </div>
	<br>
    <th:block sec:authorize="!hasRole('ROLE_EXPERT')">
      <div class="cta-banner text-center mt-5 p-4" style="background: #e8eaf6; border-radius: 10px;">
        <h4>ì „ë¬¸ê°€ì´ì‹ ê°€ìš”?</h4>
        <p>ì§€ê¸ˆ ë“±ë¡í•˜ê³  ê³ ê°ê³¼ ë§¤ì¹­ë˜ì–´ ë³´ì„¸ìš”.</p>
        <a href="/user/expert/register" class="btn btn-primary">ì „ë¬¸ê°€ ë“±ë¡í•˜ê¸°</a>
      </div>
    </th:block>
    <th:block sec:authorize="hasRole('ROLE_EXPERT')">
      <div class="cta-banner text-center mt-5 p-4" style="background: #e8eaf6; border-radius: 10px;">
        <h4>ì „ë¬¸ê°€ë¡œ í™œì•½í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</h4>
        <p>ê²¬ì  ê²Œì‹œíŒì—ì„œ ê³ ê°ê³¼ ë§¤ì¹­í•˜ì„¸ìš”.</p>
        <a href="/" class="btn btn-primary">ê²¬ì  ê²Œì‹œíŒ í™•ì¸í•˜ê¸°</a>
      </div>
    </th:block>
  </section>

  <div th:replace="~{footer :: footer}"></div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      axios.get("/uploads/top5")
        .then(response => {
          const posts = response.data;
          const container = document.getElementById("top5CommunityPosts");
          container.innerHTML = "";

          if (posts.length === 0) {
            container.innerHTML = "<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          posts.forEach(post => {
            const filePath = post.filePath || "";
            const isImage = /\.(jpg|jpeg|png|gif)$/i.test(filePath);
            const thumbnail = isImage
              ? `<img class="post-thumb" src="${filePath}" alt="ì¸ë„¤ì¼">`
              : `<div class="post-thumb placeholder">No Image</div>`;

            const html = `
              <div class="post-card">
                <div class="post-info">
                  <div class="post-category">ì»¤ë®¤ë‹ˆí‹°</div>
                  <a class="post-title" href="/user/community/${post.postId}/detail">
                    ${post.board.title}
                  </a>
                  <div class="post-excerpt">
                    ${post.board.content.length > 60 ? post.board.content.substring(0, 60) + "..." : post.board.content}
                  </div>
                  <div class="post-meta">
                    <span><i class="fa fa-user"></i> ${post.users.nickname}</span>
                    <span><i class="fa fa-eye"></i> ${post.views}</span>
                    <span><i class="fa fa-clock"></i> ${new Date(post.lastUpdatedAt).toLocaleDateString()}</span>
                  </div>
                </div>
                ${thumbnail}
              </div>
            `;
            container.insertAdjacentHTML("beforeend", html);
          });
        })
        .catch(error => {
          console.error("Top5 ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
          document.getElementById("top5CommunityPosts").innerHTML =
            "<p>ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</p>";
        });
    });
  </script>
</body>
</html>
