<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<title>로그인</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		.kakao-btn {
			background-color: #FEE500;
			color: #000;
			border: none;
		}

		.kakao-btn:hover {
			background-color: #ffe812;
		}

		.reset-link {
			font-size: 0.9em;
			color: #6c757d;
			text-decoration: none;
		}

		.reset-link:hover {
			text-decoration: underline;
		}

		.error-message {
			font-size: 0.9em;
			color: red;
			display: none;
		}
	</style>
</head>

<body class="bg-light">

	<!-- 에러 메시지 -->
	<div th:if="${param.error}" class="alert alert-danger mt-2 text-center">
		이메일 또는 비밀번호가 잘못되었습니다.
	</div>

	<div class="container mt-5">
		<div class="row justify-content-center">
			<div class="col-md-5">
				<div class="card shadow-lg">
					<div class="card-header text-center bg-primary text-white">
						<h4 class="mb-0">로그인</h4>
					</div>
					<div class="card-body">
						<!-- 로그인 폼 -->
						<form id="loginForm" action="/loginPro" method="post">
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

							<!-- 이메일 -->
							<div class="mb-3">
								<label for="id" class="form-label">이메일</label>
								<input type="text" class="form-control" id="id" name="id" placeholder="이메일을 입력하세요">
								<div class="error-message" id="emailError">이메일을 입력해주세요.</div>
							</div>

							<!-- 비밀번호 -->
							<div class="mb-3">
								<label for="pw" class="form-label">비밀번호</label>
								<input type="password" class="form-control" id="pw" name="pw" placeholder="비밀번호를 입력하세요">
								<div class="error-message" id="passwordError">비밀번호를 입력해주세요.</div>
							</div>

							<!-- 이메일 로그인 버튼 -->
							<div class="d-grid mb-3">
								<button type="submit" class="btn btn-primary" id="loginBtn">이메일 로그인</button>
							</div>
						</form>

						<!-- 링크: 회원가입 | 비밀번호 재설정 -->
						<div class="text-center my-3">
							<a href="/signup" class="reset-link d-inline" onclick="event.stopPropagation()">이메일로 가입</a>
							<span class="text-muted mx-2">|</span>
							<a href="/reset-password" class="reset-link d-inline" onclick="event.stopPropagation()">비밀번호
								재설정</a>
						</div>

						<!-- 카카오 로그인 -->
						<div class="d-grid">
							<a href="/oauth2/authorization/kakao" class="btn kakao-btn">
								<img src="https://developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_small.png"
									alt="카카오" style="width: 20px; margin-right: 8px;">카카오로 시작하기
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 유효성 검사 스크립트 -->
	<script>
		const emailInput = document.getElementById('id');
		const passwordInput = document.getElementById('pw');
		const emailError = document.getElementById('emailError');
		const passwordError = document.getElementById('passwordError');

		const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

		function validateEmail() {
			const email = emailInput.value.trim();
			if (email === '') {
				emailError.textContent = '이메일을 입력해주세요.';
				emailError.style.display = 'block';
				return false;
			} else if (!emailRegex.test(email)) {
				emailError.textContent = '올바른 이메일 형식을 입력해주세요.';
				emailError.style.display = 'block';
				return false;
			} else {
				emailError.style.display = 'none';
				return true;
			}
		}

		function validatePassword() {
			const password = passwordInput.value.trim();
			if (password === '') {
				passwordError.textContent = '비밀번호를 입력해주세요.';
				passwordError.style.display = 'block';
				return false;
			} else {
				passwordError.style.display = 'none';
				return true;
			}
		}

		// 실시간 유효성 검사
		let ignoreValidation = false;

		// 실시간 유효성 검사
		emailInput.addEventListener('input', () => {
			if (!ignoreValidation) validateEmail();
		});
		emailInput.addEventListener('blur', () => {
			if (!ignoreValidation) validateEmail();
		});

		passwordInput.addEventListener('input', () => {
			if (!ignoreValidation) validatePassword();
		});
		passwordInput.addEventListener('blur', () => {
			if (!ignoreValidation) validatePassword();
		});

		// 로그인 버튼 클릭 시만 유효성 검사 실행
		document.getElementById('loginBtn').addEventListener('click', function (e) {
			ignoreValidation = false;

			const isEmailValid = validateEmail();
			const isPasswordValid = validatePassword();

			if (!isEmailValid) {
				e.preventDefault();
				emailInput.focus();
				return;
			}

			if (!isPasswordValid) {
				e.preventDefault();
				passwordInput.focus();
				return;
			}
		});

		// 링크 클릭 시 유효성 검사 중지
		document.querySelectorAll('a.reset-link').forEach(link => {
			link.addEventListener('click', () => {
				ignoreValidation = true;
			});
		});
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>